<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>미사그 대학 한국 캠퍼스</title>

    <link rel="icon" type="image/webp" href="images/smile_Ramona.webp">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://morimenz-kr.github.io/Morimens.Info.kr/">
    <meta property="og:title" content="미사그 대학 한국 캠퍼스 - 종합 가이드">
    <meta property="og:description" content="캐릭터 공략, 환몽심잠, 융재금구, 쿠폰 등 미사그 대학의 모든 정보를 한눈에 확인하세요.">
    <meta property="og:image" content="https://morimenz-kr.github.io/Morimens.Info.kr/images/background.png">

    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages/landing.css">
    <link rel="stylesheet" href="css/responsive.css">
    <script src="config/config.js"></script>
</head>

<body>
<div class="bg-image"></div>
<div class="background-overlay"></div>

<div class="landing-container">
    <header>
        <h1>미사그 대학 한국 캠퍼스</h1>
    </header>

    <div class="banner-container">
        <div class="banner-track" id="banner-track">

            <a href="https://www.youtube.com/@morimensofficial" target="_blank" class="banner-slide">
                <img src="images/banner_youtube.png" alt="유튜브 배너">
            </a>

            <a href="https://discord.com/invite/VJhuUdHxmc/" target="_blank" class="banner-slide">
                <img src="images/Banner_Discord.png" alt="디스코드 배너">
            </a>

        </div>

        <button class="arrow left" id="prev-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>
        <button class="arrow right" id="next-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>

        <div class="dots-container" id="dots-container"></div>
    </div>

    <div class="menu-grid">
        <a href="links.html?category=event" class="menu-wrapper wide-menu">
            <div class="menu-item">🎉</div>
            <p class="menu-label">진행중인 이벤트 관련 정보</p>
        </a>

        <a href="links.html?category=weekly_yungjae" class="menu-wrapper wide-menu">
            <div class="menu-item">🔥</div>
            <p class="menu-label">진행중인 융재 금구 팁</p>
        </a>

        <a href="list.html" class="menu-wrapper">
            <div class="menu-item">⭐</div>
            <p class="menu-label">각성체 정보</p>
        </a>
        <a href="links.html?category=faction" class="menu-wrapper">
            <div class="menu-item">🎭</div>
            <p class="menu-label">계역별 정보</p>
        </a>
        <a href="links.html?category=dreamdive" class="menu-wrapper">
            <div class="menu-item">🌊</div>
            <p class="menu-label">환몽심잠 정보</p>
        </a>
        <a href="links.html?category=weapon" class="menu-wrapper">
            <div class="menu-item">🗡️</div>
            <p class="menu-label">융재금구 정보</p>
        </a>
        <a href="links.html?category=system" class="menu-wrapper">
            <div class="menu-item">⚙️</div>
            <p class="menu-label">시스템 정보</p>
        </a>
        <a href="links.html?category=covenant" class="menu-wrapper">
            <div class="menu-item">📜</div>
            <p class="menu-label">비밀계약 정보</p>
        </a>
        <a href="links.html?category=myeongryun" class="menu-wrapper">
            <div class="menu-item">🔘</div>
            <p class="menu-label">명륜 정보</p>
        </a>
        <a href="links.html?category=silverkey" class="menu-wrapper">
            <div class="menu-item">🔑</div>
            <p class="menu-label">은열쇠 정보</p>
        </a>
        <a href="links.html?category=chess" class="menu-wrapper">
            <div class="menu-item">♟️</div>
            <p class="menu-label">페이즈 체스</p>
        </a>
        <a href="links.html?category=code" class="menu-wrapper">
            <div class="menu-item">🎟️</div>
            <p class="menu-label">교환 코드</p>
        </a>
        <a href="links.html?category=newbie" class="menu-wrapper">
            <div class="menu-item">🐣</div>
            <p class="menu-label">뉴비 팁</p>
        </a>
        <a href="links.html?category=etc" class="menu-wrapper">
            <div class="menu-item">🎸</div>
            <p class="menu-label">기타</p>
        </a>
    </div>

    <footer>
        &copy; 2025 미사그 대학 한국 캠퍼스 |
        <span id="open-patch-modal" class="patch-link">Patch Notes</span> |
        <a href="https://buymeacoffee.com/mythag.univ.kr" target="_blank" class="sponsor-link">☕ 후원하기</a>
    </footer>
</div>

<div id="patch-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>📢 업데이트 내역</h2>
            <button id="close-patch-modal" class="close-btn">&times;</button>
        </div>
        <div class="patch-list" id="patch-list-content">
            <p style="text-align:center; color:#777;">로딩 중...</p>
        </div>
    </div>
</div>

<div id="report-modal" class="modal-overlay">
    <div class="modal-content">
        <h2 class="form-title">🚨 버그 제보 or 피드백</h2>
        <p style="color:#aaa; font-size:0.9em;">제보하실 내용을 적어주세요. 개발자에게 즉시 알림이 전송됩니다.</p>

        <form id="bug-report-form" action="javascript:void(0);" onsubmit="sendToDiscord(event)" method="POST">

            <label for="reporter-email" class="form-field-label">패치노트에 올라갈 닉네임 (선택)</label>
            <input type="text" id="reporter-email" name="_replyto" class="form-input"
                   placeholder="패치노트에 언급을 원하시면 적어주세요.">

            <label for="report-message" class="form-field-label">
                제보할 내용 (버그 or 피드백) (필수)
                <span style="display:block; margin-top:5px; font-size:0.9em; color:#ff9f43; font-weight:normal;">
                        ※ 특정 게시글/정보 관련 제보라면, <u>해당 글의 링크</u>를 본문에 꼭 적어주세요!
                    </span>
            </label>
            <textarea id="report-message" name="message" class="form-textarea" required
                      placeholder="내용을 입력해주세요. (예: 'XX 캐릭터 공략 링크가 안 열려요', '이 링크(URL) 접속이 안 돼요')"></textarea>

            <input type="hidden" name="report_source_url" id="report-source-url">
            <button type="submit" class="form-submit-btn">제보 보내기</button>
            <p id="modal-form-status" style="margin-top: 15px; color:#ffc107; text-align:center; display: none;">전송 중...</p>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- 배너 슬라이더 로직 ---
        const track = document.getElementById('banner-track');
        const originalSlides = Array.from(track.children);
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const dotsContainer = document.getElementById('dots-container');

        const slideCount = originalSlides.length;
        let currentIndex = 1;
        let autoSlideInterval;
        let isTransitioning = false;

        const firstClone = originalSlides[0].cloneNode(true);
        const lastClone = originalSlides[slideCount - 1].cloneNode(true);

        track.appendChild(firstClone);
        track.insertBefore(lastClone, originalSlides[0]);

        track.style.transform = `translateX(-100%)`;

        originalSlides.forEach((_, idx) => {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            if (idx === 0) dot.classList.add('active');
            dot.addEventListener('click', () => {
                resetTimer();
                moveToSlide(idx + 1);
            });
            dotsContainer.appendChild(dot);
        });
        const dots = Array.from(dotsContainer.children);

        function updateDots(index) {
            let realIndex = index - 1;
            if (realIndex < 0) realIndex = slideCount - 1;
            if (realIndex >= slideCount) realIndex = 0;

            dots.forEach(d => d.classList.remove('active'));
            dots[realIndex].classList.add('active');
        }

        function moveToSlide(index) {
            if (isTransitioning) return;
            isTransitioning = true;

            track.style.transition = 'transform 0.5s ease-in-out';
            track.style.transform = `translateX(-${index * 100}%)`;
            currentIndex = index;
            updateDots(currentIndex);
        }

        track.addEventListener('transitionend', () => {
            isTransitioning = false;
            if (currentIndex === slideCount + 1) {
                track.style.transition = 'none';
                currentIndex = 1;
                track.style.transform = `translateX(-100%)`;
            }
            if (currentIndex === 0) {
                track.style.transition = 'none';
                currentIndex = slideCount;
                track.style.transform = `translateX(-${slideCount * 100}%)`;
            }
        });

        function resetTimer() {
            clearInterval(autoSlideInterval);
            autoSlideInterval = setInterval(() => moveToSlide(currentIndex + 1), 5000);
        }

        nextBtn.addEventListener('click', () => {
            resetTimer();
            moveToSlide(currentIndex + 1);
        });

        prevBtn.addEventListener('click', () => {
            resetTimer();
            moveToSlide(currentIndex - 1);
        });

        resetTimer();

        const bannerContainer = document.querySelector('.banner-container');
        bannerContainer.addEventListener('mouseenter', () => clearInterval(autoSlideInterval));
        bannerContainer.addEventListener('mouseleave', () => resetTimer());


        // --- 패치노트 로직 ---
        const modal = document.getElementById('patch-modal');
        const openBtn = document.getElementById('open-patch-modal');
        const closeBtn = document.getElementById('close-patch-modal');
        const listContent = document.getElementById('patch-list-content');

        async function loadPatchNotes() {
            try {
                const ts = new Date().getTime();
                const res = await fetch(`data/patch_notes.json?t=${ts}`);
                if (!res.ok) throw new Error('Load failed');
                const data = await res.json();
                let html = '';
                data.forEach(item => {
                    let changesHtml = item.changes.map(c => `<li>${c}</li>`).join('');
                    html += `<div class="patch-item"><span class="patch-ver">${item.version}</span><span class="patch-date">${item.date}</span><ul class="patch-desc">${changesHtml}</ul></div><hr style="border-color:#333; opacity:0.5;">`;
                });
                listContent.innerHTML = html.replace(/\<hr[^\>]*\>(?=[^\<]*$)/, '');

                if (data.length > 0) {
                    openBtn.textContent = `Patch Notes ${data[0].version}`;
                }
            } catch (e) { listContent.innerHTML = '로드 실패'; }
        }

        loadPatchNotes();

        openBtn.addEventListener('click', () => { modal.classList.add('show'); });
        closeBtn.addEventListener('click', () => modal.classList.remove('show'));
        modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('show'); });

        // 모달 닫기 이벤트 리스너 바인딩
        const reportModal = document.getElementById('report-modal');
        if (reportModal) {
            reportModal.addEventListener('click', (e) => {
                if (e.target === reportModal) {
                    reportModal.classList.remove('show');
                }
            });
        }
    });

    // --- 신고 모달 함수 ---
    function openReportModal() {
        const modal = document.getElementById('report-modal');
        const modalStatus = document.getElementById('modal-form-status');
        const sourceUrlInput = document.getElementById('report-source-url');

        if (modalStatus) {
            modalStatus.style.display = 'none';
            modalStatus.textContent = '제보를 전송 중입니다...';
            modalStatus.style.color = '#ffc107';
        }

        if (sourceUrlInput) {
            sourceUrlInput.value = window.location.href;
        }

        modal.classList.add('show');
    }

    async function sendToDiscord(event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const modalStatus = document.getElementById('modal-form-status');
        const modal = document.getElementById('report-modal');

        if (modalStatus) {
            modalStatus.style.display = 'block';
            modalStatus.textContent = '제보를 전송 중입니다...';
            modalStatus.style.color = '#ffc107';
        }

        const reporterEmail = formData.get('_replyto') || '익명(Anonymous)';
        const message = formData.get('message');
        const sourceUrl = formData.get('report_source_url') || window.location.href;

        const payload = {
            username: "Morimens Wiki Bot",
            embeds: [{
                title: "📩 새로운 제보가 도착했습니다!",
                description: "위키에서 유저 피드백/버그 제보가 접수되었습니다.",
                color: 0xFF9F43,
                fields: [
                    { name: "👤 제보자", value: `\`${reporterEmail}\``, inline: true },
                    { name: "📍 발생 페이지", value: `[바로가기(Click)](${sourceUrl})`, inline: true },
                    { name: "📝 상세 내용", value: `>>> ${message}`, inline: false }
                ],
                footer: { text: "Morimens Wiki Report System" },
                timestamp: new Date().toISOString()
            }]
        };

        try {
            const webhookUrl = (typeof CONFIG !== 'undefined') ? CONFIG.DISCORD_WEBHOOK_URL : '';
            if(!webhookUrl) throw new Error("Config Error");

            await fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (modalStatus) {
                modalStatus.textContent = "✅ 전송 완료! 감사합니다.";
                modalStatus.style.color = "#2ecc71";
            }
            form.reset();
            setTimeout(() => {
                modal.classList.remove('show');
                if (modalStatus) {
                    modalStatus.style.display = 'none';
                    modalStatus.textContent = '제보를 전송 중입니다...';
                    modalStatus.style.color = '#ffc107';
                }
            }, 1500);
        } catch (error) {
            console.error(error);
            if (modalStatus) {
                modalStatus.textContent = '❌ 설정 오류 또는 네트워크 오류입니다.';
                modalStatus.style.color = "#e74c3c";
            }
        }
    }
</script>
<button class="floating-report-btn" onclick="openReportModal()"
        title="버그 신고">
    🚨
</button>
</body>
</html>