<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§í¬ ë°ì´í„° ë² ì´ì»¤ (Editor Tool)</title>
    <style>
        /* ê°œë°œì ê°ì„± ë‹¤í¬ ëª¨ë“œ */
        body { background-color: #1e1e1e; color: #d4d4d4; font-family: 'Consolas', 'Monaco', monospace; padding: 30px; }
        .container { max-width: 900px; margin: 0 auto; }

        h1 { color: #ffc107; border-bottom: 2px solid #333; padding-bottom: 10px; }
        p { color: #888; }

        /* ì…ë ¥ì°½ */
        textarea {
            width: 100%; height: 150px;
            background-color: #252526; color: #d4d4d4;
            border: 1px solid #444; padding: 15px;
            border-radius: 5px; font-size: 14px; outline: none; resize: vertical;
        }
        textarea:focus { border-color: #007acc; }

        /* ë²„íŠ¼ë“¤ */
        .btn-group { margin-top: 15px; display: flex; gap: 10px; }
        button {
            padding: 12px 24px; border: none; border-radius: 4px;
            font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s;
        }
        .btn-bake { background-color: #0e639c; color: white; }
        .btn-bake:hover { background-color: #1177bb; }
        .btn-copy { background-color: #333; color: white; }
        .btn-copy:hover { background-color: #444; }

        /* ê²°ê³¼ì°½ */
        .output-area { margin-top: 30px; position: relative; }
        pre {
            background-color: #1e1e1e; border: 1px solid #444;
            padding: 20px; border-radius: 5px; overflow-x: auto;
            color: #ce9178; /* JSON String Color */
            white-space: pre-wrap;
        }

        .status { margin-top: 10px; font-weight: bold; color: #4caf50; min-height: 24px; }
        .error { color: #f44336; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ Data Baker Tool</h1>
    <p>1. ê³µëµ URLë“¤ì„ í•œ ì¤„ì— í•˜ë‚˜ì”© ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. (ì§§ì€ ì£¼ì†Œ, ê¸´ ì£¼ì†Œ ìƒê´€ì—†ìŒ)</p>

    <textarea id="inputUrls" placeholder="https://arca.live/b/morimens/12345&#10;https://game.naver.com/lounge/Morimens/board/detail/67890"></textarea>

    <div class="btn-group">
        <button class="btn-bake" onclick="bakeLinks()">ğŸ”¥ ë°ì´í„° êµ½ê¸° (Bake)</button>
        <button class="btn-copy" onclick="copyToClipboard()">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
    </div>

    <div id="status" class="status"></div>

    <div class="output-area">
        <p>â–¼ ì•„ë˜ ìƒì„±ëœ JSON ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ <b>resource_links.json</b>ì˜ ëŒ€ê´„í˜¸ [ ] ì•ˆì— ë„£ìœ¼ì„¸ìš”.</p>
        <pre id="outputResult">// ê²°ê³¼ê°€ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</pre>
    </div>
</div>

<script>
    async function bakeLinks() {
        const input = document.getElementById('inputUrls').value.trim();
        const statusEl = document.getElementById('status');
        const outputEl = document.getElementById('outputResult');

        if (!input) {
            statusEl.innerHTML = "<span class='error'>âŒ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!</span>";
            return;
        }

        const urls = input.split('\n').filter(line => line.trim() !== '');
        let bakedResults = [];
        let successCount = 0;

        statusEl.textContent = `â³ ì´ ${urls.length}ê°œì˜ ë§í¬ ì •ë³´ë¥¼ ìˆ˜ì§‘ ì¤‘... (Microlink API)`;

        // ë³‘ë ¬ ì²˜ë¦¬ (Promise.all) - ì†ë„ ë¹ ë¦„
        const tasks = urls.map(async (url) => {
            const cleanUrl = url.trim();
            try {
                // ë¬´ë£Œ API í˜¸ì¶œ
                const res = await fetch(`https://api.microlink.io?url=${encodeURIComponent(cleanUrl)}`);
                const json = await res.json();

                if (json.status === 'success') {
                    const data = json.data;
                    successCount++;
                    return {
                        url: cleanUrl,
                        title: data.title || cleanUrl, // ì œëª© ì—†ìœ¼ë©´ URLë¡œ ëŒ€ì²´
                        desc: data.description || "",   // ì„¤ëª… ì—†ìœ¼ë©´ ë¹ˆì¹¸
                        image: data.image?.url || ""    // ì´ë¯¸ì§€ ì—†ìœ¼ë©´ ë¹ˆì¹¸
                    };
                } else {
                    throw new Error("API Fail");
                }
            } catch (e) {
                // ì‹¤íŒ¨ ì‹œ URLë§Œ ë°˜í™˜ (ë§í¬ëŠ” ì‚´ë¦¼)
                console.warn("ì‹¤íŒ¨í•œ URL:", cleanUrl);
                return cleanUrl;
            }
        });

        // ëª¨ë“  ìš”ì²­ì´ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°
        const results = await Promise.all(tasks);

        // JSON í¬ë§·íŒ… (ë³´ê¸° ì¢‹ê²Œ ë“¤ì—¬ì“°ê¸° 4ì¹¸)
        // ë°°ì—´ì˜ ëŒ€ê´„í˜¸ [ ] ëŠ” ì œê±°í•˜ê³  ë‚´ìš©ë¬¼ë§Œ ë³´ì—¬ì¤Œ (ë¶™ì—¬ë„£ê¸° í¸í•˜ê²Œ)
        const jsonString = JSON.stringify(results, null, 4);
        const contentOnly = jsonString.substring(1, jsonString.length - 1).trim();

        // ë§ˆì§€ë§‰ì— ì‰¼í‘œê°€ ì—†ìœ¼ë©´ ì¶”ê°€í•´ì¤„ ìˆ˜ë„ ìˆì§€ë§Œ, ì¼ë‹¨ ì›ë³¸ ìœ ì§€
        outputEl.textContent = contentOnly;

        statusEl.innerHTML = `âœ… ë³€í™˜ ì™„ë£Œ! (ì„±ê³µ: ${successCount} / ì „ì²´: ${urls.length})`;
    }

    function copyToClipboard() {
        const text = document.getElementById('outputResult').textContent;
        if(!text || text.startsWith("//")) return;

        navigator.clipboard.writeText(text).then(() => {
            alert("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! resource_links.jsonì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
        });
    }
</script>
</body>
</html>