<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="config/config.js"></script>
    <script>
        loadCSS('css/common.css');
        loadCSS('css/party_builder.css');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>융재금지구역 파티 시뮬레이터</title>
    <link rel="icon" type="image/webp" href="images/smile_Ramona.webp">
</head>
<body>

<div class="builder-container">
    <div class="sidebar" id="sidebar-tabs"></div>
    <div class="main-area">
        <div class="back-btn-wrapper">
            <a href="javascript:void(0);" onclick="goBackToMenu()" class="back-btn">⬅ 융재금구 메뉴로 돌아가기</a>
        </div>

        <div class="header-wrapper">
            <div class="header-left">
                <h2 id="team-title-text">TEAM I</h2>
                <svg class="edit-icon" onclick="editTeamName()" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 17.25V21H6.75L17.81 9.94L14.06 6.19L3 17.25ZM20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C17.98 2.9 17.35 2.9 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04Z" />
                </svg>
                <div id="team-domain-container" class="header-domain-wrap"></div>
            </div>
            <button class="btn btn-red btn-sm" onclick="resetCurrentTeam()">팀 초기화</button>
        </div>

        <div class="content-row">
            <div class="slots-container" id="team-slots"></div>
        </div>

        <div class="bottom-section">
            <div class="silverkey-box" onclick="openKeyModal()">
                <div class="key-circle" id="key-icon">+</div>
                <div class="key-info">
                    <div>은열쇠</div>
                    <div id="key-name">장착 안 함</div>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-blue" onclick="openQuickSetup()">빠른 편성</button>
                <button class="btn btn-yellow" onclick="saveAllData()">저장</button>
            </div>
        </div>
    </div>
</div>

<div id="modal-char" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <h3>배치할 각성체 선택 (최대 4명)</h3>
            <button class="close-btn" onclick="closeModal('modal-char')">&times;</button>
        </div>

        <div class="char-search-section">
            <div class="search-container">
                <div class="search-input-box">
                    <div class="search-input-wrapper">
                        <svg class="search-icon-svg" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        <input type="text" id="char-search-input" placeholder="이름 또는 특성 검색 (예: 죽저, 크리티컬)..." autocomplete="off">
                    </div>
                    <div id="char-search-suggestions" class="suggestions-dropdown"></div>
                </div>
            </div>

            <div class="char-filter-container">
                <div class="filter-group">
                    <span class="filter-label">영역:</span>
                    <div class="filter-chip" onclick="toggleCharFilter('domain', 'chaos')">혼돈</div>
                    <div class="filter-chip" onclick="toggleCharFilter('domain', 'aequor')">심해</div>
                    <div class="filter-chip" onclick="toggleCharFilter('domain', 'caro')">혈육</div>
                    <div class="filter-chip" onclick="toggleCharFilter('domain', 'ultra')">초차원</div>
                </div>
                <div class="filter-group" style="border-left:1px solid #444; padding-left:20px;">
                    <span class="filter-label">역할:</span>
                    <div class="filter-chip" onclick="toggleCharFilter('class', 'assault')">공격형</div>
                    <div class="filter-chip" onclick="toggleCharFilter('class', 'warden')">방어형</div>
                    <div class="filter-chip" onclick="toggleCharFilter('class', 'chorus')">보조형</div>
                </div>
            </div>

            <div id="active-char-search-tags" class="active-tags-list"></div>
        </div>

        <div class="modal-grid" id="grid-char"></div>
        <div class="modal-footer">
            <span id="char-count" style="color:#aaa; margin-right:15px; font-size:0.9em;">0 / 4 선택됨</span>
            <button class="btn btn-yellow" onclick="confirmQuickSetup()">배치 확정</button>
        </div>
    </div>
</div>

<div id="modal-wheel" class="modal-overlay">
    <div class="modal-box-wide">
        <div class="wheel-list-wrapper">
            <div class="search-container">
                <div class="search-input-box">
                    <div class="search-input-wrapper">
                        <svg class="search-icon-svg" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        <input type="text" id="wheel-search-input" placeholder="태그 또는 이름 검색..." autocomplete="off">
                    </div>
                    <div id="search-suggestions" class="suggestions-dropdown"></div>
                </div>
                <div id="active-tags-area" class="active-tags-list"></div>
            </div>
            <div class="wheel-list-panel" id="grid-wheel"></div>
        </div>
        <div class="wheel-equip-panel">
            <h3 style="color:#eee; margin-bottom:20px;">장착 슬롯 선택</h3>
            <div class="wheel-equip-slots">
                <div class="large-slot" id="equip-slot-0" onclick="selectWheelSlot(0)"><div class="slot-placeholder">+</div></div>
                <div class="large-slot" id="equip-slot-1" onclick="selectWheelSlot(1)"><div class="slot-placeholder">+</div></div>
            </div>
            <div class="equip-info-text" id="equip-slot-desc" style="color:#777; margin-bottom:20px; text-align:center; min-height:40px;">슬롯을 선택하고 좌측 목록에서 명륜을 클릭하세요.</div>
            <button class="btn btn-red" onclick="unequipSelectedWheel()">해제</button>
            <button class="btn btn-blue" onclick="closeModal('modal-wheel')" style="margin-top:15px; width: 100px;">닫기</button>
        </div>
    </div>
</div>

<div id="modal-key" class="modal-overlay">
    <div class="modal-box" style="max-width:600px; height:80vh;">
        <div class="modal-header"><h3>은열쇠 선택</h3><button class="close-btn" onclick="closeModal('modal-key')">&times;</button></div>
        <div class="search-container">
            <div class="search-input-box">
                <div class="search-input-wrapper">
                    <svg class="search-icon-svg" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                    <input type="text" id="key-search-input" placeholder="태그 또는 이름 검색..." autocomplete="off">
                </div>
                <div id="key-search-suggestions" class="suggestions-dropdown"></div>
            </div>
            <div id="active-key-tags-area" class="active-tags-list"></div>
        </div>
        <div class="modal-grid" id="grid-key"></div>
        <div class="modal-footer">
            <button class="btn btn-red" onclick="unequipKey()" style="margin-right:10px;">해제</button>
            <button class="btn btn-blue" onclick="closeModal('modal-key')">닫기</button>
        </div>
    </div>
</div>

<div id="global-tooltip" class="item-tooltip">
    <div class="tooltip-title" id="tt-title"></div>
    <div class="tooltip-desc" id="tt-desc"></div>
    <div class="tooltip-tags" id="tt-tags"></div>
</div>

<div id="modal-system" class="modal-overlay">
    <div class="modal-box" style="max-width: 450px; height: auto; min-height: 200px; border-color: #777;">
        <div class="modal-header">
            <h3 id="sys-modal-title" style="color: var(--highlight);">알림</h3>
            <button class="close-btn" onclick="closeModal('modal-system')">&times;</button>
        </div>
        <div style="padding: 40px 30px; text-align: center; color: #e0e0e0; font-size: 1.1em; line-height: 1.5; white-space: pre-line;" id="sys-modal-msg">내용</div>
        <div class="modal-footer" style="justify-content: center; gap: 15px; padding-bottom: 25px;">
            <button id="sys-btn-yes" class="btn btn-yellow" style="min-width: 80px;">확인</button>
            <button id="sys-btn-no" class="btn btn-red" style="min-width: 80px; display: none;">취소</button>
        </div>
    </div>
</div>

<div id="report-modal" class="modal-overlay">
    <div class="modal-content">
        <h2 class="form-title">🚨 버그 제보 or 피드백</h2>
        <p style="color:#aaa; font-size:0.9em;">제보하실 내용을 적어주세요. 개발자에게 즉시 알림이 전송됩니다.</p>
        <form id="bug-report-form" action="javascript:void(0);" onsubmit="sendToDiscord(event)" method="POST">
            <label for="reporter-email" class="form-field-label">패치노트에 올라갈 닉네임 (선택)</label>
            <input type="text" id="reporter-email" name="_replyto" class="form-input" placeholder="패치노트에 언급을 원하시면 적어주세요.">
            <label for="report-message" class="form-field-label">
                제보할 내용 (버그 or 피드백) (필수)
                <span style="display:block; margin-top:5px; font-size:0.9em; color:#ff9f43; font-weight:normal;">※ 특정 게시글/정보 관련 제보라면, <u>해당 글의 링크</u>를 본문에 꼭 적어주세요!</span>
            </label>
            <textarea id="report-message" name="message" class="form-textarea" required placeholder="내용을 입력해주세요."></textarea>
            <input type="hidden" name="report_source_url" id="report-source-url">
            <button type="submit" class="form-submit-btn">제보 보내기</button>
            <p id="modal-form-status" style="margin-top: 15px; color:#ffc107; text-align:center; display: none;">전송 중...</p>
        </form>
    </div>
</div>
<button class="floating-report-btn" onclick="openReportModal()" title="버그 신고">🚨</button>

<script>
    loadJS('js/party_builder.js');
</script>
</body>

</body>
</html>